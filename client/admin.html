<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALICE Raffle - Admin</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --color-bg-primary: #0a0a0f;
      --color-bg-secondary: #12121a;
      --color-bg-card: rgba(18, 18, 26, 0.8);
      --color-accent-primary: #00f0ff;
      --color-accent-secondary: #ff00aa;
      --color-accent-gold: #ffd700;
      --color-text-primary: #ffffff;
      --color-text-secondary: #8a8a9a;
      --color-border: rgba(0, 240, 255, 0.2);
      --color-success: #00ff88;
      --color-warning: #ffaa00;
      --color-danger: #ff4466;
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'Rajdhani', sans-serif;
      --glow-cyan: 0 0 20px rgba(0, 240, 255, 0.5), 0 0 40px rgba(0, 240, 255, 0.2);
      --glow-pink: 0 0 20px rgba(255, 0, 170, 0.5), 0 0 40px rgba(255, 0, 170, 0.2);
      --glow-gold: 0 0 20px rgba(255, 215, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.2);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-body);
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .bg-grid {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image: 
        linear-gradient(rgba(255, 0, 170, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 170, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    .bg-gradient {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: 
        radial-gradient(ellipse at 80% 20%, rgba(255, 0, 170, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 20% 80%, rgba(0, 240, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    #root {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--color-border);
      backdrop-filter: blur(10px);
      background: rgba(10, 10, 15, 0.9);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .logo {
      font-family: var(--font-display);
      font-size: 1.5rem;
      font-weight: 800;
      letter-spacing: 0.1em;
      background: linear-gradient(135deg, var(--color-accent-secondary), var(--color-accent-primary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-decoration: none;
    }

    .admin-badge {
      font-family: var(--font-display);
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      padding: 0.3rem 0.8rem;
      background: rgba(255, 0, 170, 0.2);
      border: 1px solid var(--color-accent-secondary);
      color: var(--color-accent-secondary);
      text-transform: uppercase;
    }

    .back-link {
      font-family: var(--font-body);
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      text-decoration: none;
      transition: color 0.3s;
    }

    .back-link:hover {
      color: var(--color-accent-primary);
    }

    /* Network Switcher */
    .network-switcher {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.3rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid var(--color-border);
      border-radius: 4px;
    }

    .network-btn {
      font-family: var(--font-display);
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      padding: 0.5rem 1rem;
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .network-btn:hover {
      color: var(--color-text-primary);
    }

    .network-btn.active {
      color: var(--color-text-primary);
      background: rgba(255, 255, 255, 0.1);
    }

    .network-btn.active.sepolia {
      color: var(--color-accent-primary);
      background: rgba(0, 240, 255, 0.15);
      box-shadow: inset 0 0 10px rgba(0, 240, 255, 0.2);
    }

    .network-btn.active.bsc {
      color: #f0b90b;
      background: rgba(240, 185, 11, 0.15);
      box-shadow: inset 0 0 10px rgba(240, 185, 11, 0.2);
    }

    .network-icon {
      width: 14px;
      height: 14px;
      border-radius: 50%;
    }

    .network-icon.sepolia {
      background: linear-gradient(135deg, #627eea, #3c4d99);
    }

    .network-icon.bsc {
      background: linear-gradient(135deg, #f0b90b, #c99a0a);
    }

    .network-indicator {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem 1.5rem;
      font-family: var(--font-display);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border-radius: 0 0 8px 8px;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      animation: slideDown 0.3s ease;
    }

    .network-indicator.sepolia {
      background: linear-gradient(135deg, rgba(0, 240, 255, 0.2), rgba(0, 136, 170, 0.2));
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-top: none;
      color: var(--color-accent-primary);
    }

    .network-indicator.bsc {
      background: linear-gradient(135deg, rgba(240, 185, 11, 0.2), rgba(200, 154, 10, 0.2));
      border: 1px solid rgba(240, 185, 11, 0.3);
      border-top: none;
      color: #f0b90b;
    }

    @keyframes slideDown {
      from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    .connect-btn {
      font-family: var(--font-display);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      padding: 0.6rem 1.2rem;
      background: transparent;
      border: 2px solid var(--color-accent-primary);
      color: var(--color-accent-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }

    .connect-btn:hover {
      background: rgba(0, 240, 255, 0.1);
      box-shadow: var(--glow-cyan);
    }

    .connect-btn.connected {
      border-color: var(--color-success);
      color: var(--color-success);
    }

    .wallet-info {
      text-align: right;
    }

    .wallet-address {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      margin-top: 0.2rem;
    }

    .owner-status {
      font-size: 0.7rem;
      margin-top: 0.2rem;
    }

    .owner-status.is-owner {
      color: var(--color-success);
    }

    .owner-status.not-owner {
      color: var(--color-danger);
    }

    .main {
      flex: 1;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .status-bar {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .status-item {
      padding: 0.8rem 1.2rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .status-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
    }

    .status-value {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 600;
    }

    .status-value.active { color: var(--color-success); }
    .status-value.paused { color: var(--color-warning); }
    .status-value.pending { color: var(--color-accent-primary); }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      backdrop-filter: blur(20px);
      padding: 1.5rem;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--color-accent-secondary), var(--color-accent-primary));
    }

    .card.danger::before {
      background: linear-gradient(90deg, var(--color-danger), var(--color-warning));
    }

    .card-title {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title-icon {
      font-size: 1.1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: 0.4rem;
    }

    .form-input {
      width: 100%;
      padding: 0.7rem 1rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      font-family: var(--font-body);
      font-size: 0.9rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-accent-primary);
      box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
    }

    .form-input::placeholder {
      color: var(--color-text-secondary);
      opacity: 0.5;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-hint {
      font-size: 0.7rem;
      color: var(--color-text-secondary);
      margin-top: 0.3rem;
    }

    .btn {
      width: 100%;
      padding: 0.9rem 1.5rem;
      font-family: var(--font-display);
      font-size: 0.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-accent-primary), #0088aa);
      color: #000;
    }

    .btn-primary:hover:not(:disabled) {
      box-shadow: var(--glow-cyan);
      transform: translateY(-1px);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--color-success), #00aa66);
      color: #000;
    }

    .btn-success:hover:not(:disabled) {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
      transform: translateY(-1px);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--color-warning), #cc8800);
      color: #000;
    }

    .btn-warning:hover:not(:disabled) {
      box-shadow: 0 0 20px rgba(255, 170, 0, 0.5);
      transform: translateY(-1px);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--color-danger), #cc2244);
      color: #fff;
    }

    .btn-danger:hover:not(:disabled) {
      box-shadow: 0 0 20px rgba(255, 68, 102, 0.5);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--color-accent-primary);
    }

    .btn.loading::after {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 200%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .info-box {
      padding: 1rem;
      background: rgba(0, 240, 255, 0.05);
      border: 1px solid rgba(0, 240, 255, 0.2);
      margin-bottom: 1rem;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 0.4rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    .info-value {
      font-family: var(--font-display);
      font-size: 0.8rem;
      color: var(--color-accent-primary);
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      backdrop-filter: blur(10px);
      font-family: var(--font-body);
      font-size: 0.9rem;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }

    .toast.success { border-color: var(--color-success); color: var(--color-success); }
    .toast.error { border-color: var(--color-danger); color: var(--color-danger); }
    .toast.warning { border-color: var(--color-warning); color: var(--color-warning); }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem;
      gap: 1.5rem;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid var(--color-border);
      border-top-color: var(--color-accent-secondary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text {
      font-family: var(--font-display);
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      color: var(--color-text-secondary);
      text-transform: uppercase;
    }

    .not-connected {
      text-align: center;
      padding: 4rem 2rem;
    }

    .not-connected-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .not-connected h2 {
      font-family: var(--font-display);
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .not-connected p {
      color: var(--color-text-secondary);
      margin-bottom: 1.5rem;
    }

    .footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.7rem;
      color: var(--color-text-secondary);
      border-top: 1px solid var(--color-border);
    }

    .contract-address-link {
      color: var(--color-accent-primary);
      text-decoration: none;
      transition: color 0.3s;
    }

    .contract-address-link:hover {
      color: var(--color-text-primary);
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 1rem; }
      .header-left { flex-direction: column; align-items: flex-start; }
      .grid { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
      .status-bar { flex-direction: column; }
      .network-switcher { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-gradient"></div>
  <div id="root">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading Admin Panel...</div>
    </div>
  </div>

  <!-- Dependencies - Using development builds for debugging -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ============ MULTI-NETWORK CONFIGURATION ============
    
    const NETWORK_CONFIG = {
    mainnet: {
      chainId: 1,
      chainIdHex: '0x1',
      chainNamespace: 'eip155',
      rpcTarget: 'https://eth.llamarpc.com',
      displayName: 'Ethereum Mainnet',
      blockExplorer: 'https://etherscan.io',
      ticker: 'ETH',
      tickerName: 'Ethereum',
    },
      sepolia: {
        name: 'Sepolia Testnet',
        shortName: 'Sepolia',
        chainId: 11155111,
        chainIdHex: '0xaa36a7',
         rpcUrl: 'https://gateway.tenderly.co/public/sepolia',
        blockExplorer: 'https://sepolia.etherscan.io',
        contractAddress: '0xDD5e2Bd93B01b842e02ED1dc5933885C7C3f84E1',
        nativeCurrency: {
          name: 'Ethereum',
          symbol: 'ETH',
          decimals: 18,
        },
      },
          bscTestnet: {
      chainId: 97,
      chainIdHex: '0x61',
      chainNamespace: 'eip155',
      rpcTarget: 'https://data-seed-prebsc-1-s1.binance.org:8545',
      displayName: 'BSC Testnet',
      blockExplorer: 'https://testnet.bscscan.com',
      ticker: 'tBNB',
      tickerName: 'Test BNB',
      contractAddress: '0x2688184E2bBde09b7D22f0691f0D4ebbD3b39b1C'
    },
      bsc: {
        name: 'BNB Smart Chain',
        shortName: 'BSC',
        chainId: 56,
        chainIdHex: '0x38',
        rpcUrl: 'https://bsc-dataseed.binance.org',
        blockExplorer: 'https://bscscan.com',
        contractAddress: '0x0000000000000000000000000000000000000000', // TODO: Replace with actual BSC contract
        nativeCurrency: {
          name: 'BNB',
          symbol: 'BNB',
          decimals: 18,
        },
      },
    };

    const ALICE_DECIMALS = 6;
    
    // Raffle Admin Role - keccak256("RAFFLE_ADMIN_ROLE")
    const RAFFLE_ADMIN_ROLE = '0x5b4b8088d200445bfb44acef5ae68c0906d30def45a3f841c2e4c6f0a2b1e914';
    
    // ============ END CONFIGURATION ============

    // Full Admin ABI
    const RAFFLE_ABI = [
      // Read functions
      "function paused() view returns (bool)",
      "function owner() view returns (address)",
      "function hasRole(bytes32 role, address account) view returns (bool)",
      "function currentRaffleId() view returns (uint256)",
      "function awaitingVrf() view returns (bool)",
      "function houseFee() view returns (uint256)",
      "function accumulatedHouseFees() view returns (uint256)",
      "function subscriptionId() view returns (uint256)",
      "function keyHash() view returns (bytes32)",
      "function callbackGasLimit() view returns (uint32)",
      "function requestConfirmations() view returns (uint16)",
      "function getRaffleConfig(uint256 raffleId) view returns (tuple(uint256 ticketPrice, string genericReward, uint8 genericRewardAmount, string winnerReward, uint8 winnerRewardAmount, uint256 prizePool, address winner, bool winnerClaimed, bool isActive))",
      "function getTicketCount(uint256 raffleId) view returns (uint256)",
      "function ALICE_TOKEN() view returns (address)",
      
      // Write functions
      "function startRaffle(uint256 _ticketPrice, string _genericReward, uint8 _genericAmount, string _winnerReward, uint8 _winnerAmount)",
      "function stopRaffle()",
      "function setHouseFee(uint256 _houseFee)",
      "function updateVRFConfig(uint256 _subscriptionId, bytes32 _keyHash, uint32 _callbackGasLimit, uint16 _requestConfirmations)",
      "function withdrawHouseFees(address recipient)",
      "function emergencyPause()",
      "function transferOwnership(address newOwner)",
      "function injectCapital(uint256 amount)",
    ];

    // ERC20 ABI for approval
    const ERC20_ABI = [
      "function approve(address spender, uint256 amount) returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)",
      "function balanceOf(address account) view returns (uint256)",
    ];

    // Helpers
    const formatAlice = (amount) => {
      if (!amount || amount === '0') return '0';
      try {
        // amount should now be a string representation of the BigNumber
        const formatted = ethers.utils.formatUnits(amount.toString(), ALICE_DECIMALS);
        return parseFloat(formatted).toLocaleString();
      } catch (e) {
        console.error('formatAlice error:', e, amount);
        return '0';
      }
    };

    const parseAlice = (amount) => {
      return ethers.utils.parseUnits(amount.toString(), ALICE_DECIMALS);
    };

    const shortenAddress = (address) => {
      if (!address) return '';
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    };

    // Helper to safely convert BigNumber to number
    const toNumber = (value) => {
      if (value === null || value === undefined) return 0;
      if (value._isBigNumber) {
        try {
          return value.toNumber();
        } catch (e) {
          // If number is too large, return as string converted to number
          return parseInt(value.toString(), 10) || 0;
        }
      }
      if (typeof value === 'number') return value;
      if (typeof value === 'string') return parseInt(value, 10) || 0;
      return 0;
    };

    // Helper to safely convert BigNumber to string (for large numbers)
    const toBigNumberString = (value) => {
      if (value === null || value === undefined) return '0';
      if (value._isBigNumber) {
        return value.toString();
      }
      if (typeof value === 'number' || typeof value === 'string') {
        return value.toString();
      }
      return '0';
    };

    // Main Admin App
    function AdminApp() {
      const [activeNetwork, setActiveNetwork] = useState('sepolia');
      const [provider, setProvider] = useState(null);
      const [signer, setSigner] = useState(null);
      const [userAddress, setUserAddress] = useState(null);
      const [contract, setContract] = useState(null);
      const [aliceContract, setAliceContract] = useState(null);
      
      const [loading, setLoading] = useState(true);
      const [toast, setToast] = useState(null);
      const [networkMismatch, setNetworkMismatch] = useState(false);
      
      // Contract state
      const [contractState, setContractState] = useState({
        owner: null,
        paused: true,
        awaitingVrf: false,
        currentRaffleId: 0,
        houseFee: 0,
        accumulatedFees: '0',
        vrfConfig: {},
        currentRaffle: null,
        ticketCount: 0,
      });

      const [isAdmin, setIsAdmin] = useState(false);

      // Form states
      const [startRaffleForm, setStartRaffleForm] = useState({
        ticketPrice: '',
        genericReward: '',
        genericAmount: '1',
        winnerReward: '',
        winnerAmount: '1',
      });

      const [houseFeeForm, setHouseFeeForm] = useState('');
      const [withdrawAddress, setWithdrawAddress] = useState('');
      const [injectAmount, setInjectAmount] = useState('');
      const [newOwner, setNewOwner] = useState('');
      
      const [vrfForm, setVrfForm] = useState({
        subscriptionId: '',
        keyHash: '',
        callbackGasLimit: '',
        requestConfirmations: '',
      });

      // Loading states for buttons
      const [loadingAction, setLoadingAction] = useState(null);

      // Get current network config
      const networkConfig = NETWORK_CONFIG[activeNetwork];

      // Initialize read-only provider for active network
      useEffect(() => {
        const init = async () => {
          try {
            const readProvider = new ethers.providers.JsonRpcProvider(networkConfig.rpcUrl);
            setProvider(readProvider);
            
            const raffleContract = new ethers.Contract(
              networkConfig.contractAddress,
              RAFFLE_ABI,
              readProvider
            );
            setContract(raffleContract);
          } catch (err) {
            console.error('Init error:', err);
            showToast('Failed to connect to network', 'error');
          }
          setLoading(false);
        };
        init();
      }, [activeNetwork]);

      // Switch network
      const switchNetwork = async (newNetwork) => {
        if (newNetwork === activeNetwork) return;
        
        setActiveNetwork(newNetwork);
        setLoading(true);
        
        // Reset wallet connection when switching networks
        if (signer) {
          setSigner(null);
          setUserAddress(null);
          setIsAdmin(false);
          setAliceContract(null);
        }
        
        // Reset contract state
        setContractState({
          owner: null,
          paused: true,
          awaitingVrf: false,
          currentRaffleId: 0,
          houseFee: 0,
          accumulatedFees: '0',
          vrfConfig: {},
          currentRaffle: null,
          ticketCount: 0,
        });
        
        showToast(`Switched to ${NETWORK_CONFIG[newNetwork].name}`, 'success');
      };

      // Request network switch in wallet
      const requestWalletNetworkSwitch = async () => {
        if (!window.ethereum) return false;
        
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: networkConfig.chainIdHex }],
          });
          return true;
        } catch (switchError) {
          // Network not added to wallet, try to add it
          if (switchError.code === 4902) {
            try {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: networkConfig.chainIdHex,
                  chainName: networkConfig.name,
                  nativeCurrency: networkConfig.nativeCurrency,
                  rpcUrls: [networkConfig.rpcUrl],
                  blockExplorerUrls: [networkConfig.blockExplorer],
                }],
              });
              return true;
            } catch (addError) {
              console.error('Failed to add network:', addError);
              return false;
            }
          }
          console.error('Failed to switch network:', switchError);
          return false;
        }
      };

      // Connect wallet
      const connectWallet = async () => {
        if (!window.ethereum) {
          showToast('Please install MetaMask', 'error');
          return;
        }

        try {
          const accounts = await window.ethereum.request({ 
            method: 'eth_requestAccounts' 
          });
          
          const chainId = await window.ethereum.request({ method: 'eth_chainId' });
          const currentChainId = parseInt(chainId, 16);
          
          if (currentChainId !== networkConfig.chainId) {
            showToast(`Switching to ${networkConfig.name}...`, 'warning');
            const switched = await requestWalletNetworkSwitch();
            if (!switched) {
              showToast(`Please switch to ${networkConfig.name} manually`, 'error');
              setNetworkMismatch(true);
              return;
            }
          }
          
          setNetworkMismatch(false);
          const web3Provider = new ethers.providers.Web3Provider(window.ethereum);
          const web3Signer = web3Provider.getSigner();
          
          setSigner(web3Signer);
          setUserAddress(accounts[0]);
          
          const signedContract = new ethers.Contract(
            networkConfig.contractAddress,
            RAFFLE_ABI,
            web3Signer
          );
          setContract(signedContract);

          // Get ALICE token contract
          try {
            const aliceAddress = await signedContract.ALICE_TOKEN();
            const alice = new ethers.Contract(aliceAddress, ERC20_ABI, web3Signer);
            setAliceContract(alice);
          } catch (err) {
            console.error('Failed to get ALICE token:', err);
          }
          
          showToast('Wallet connected!', 'success');
        } catch (err) {
          console.error('Connect error:', err);
          showToast('Failed to connect wallet', 'error');
        }
      };

      // Listen for account/chain changes
      useEffect(() => {
        if (!window.ethereum) return;
        
        const handleAccountsChanged = (accounts) => {
          if (accounts.length === 0) {
            disconnectWallet();
          } else {
            setUserAddress(accounts[0]);
          }
        };
        
        const handleChainChanged = (chainId) => {
          const newChainId = parseInt(chainId, 16);
          if (newChainId !== networkConfig.chainId) {
            setNetworkMismatch(true);
            showToast(`Please switch to ${networkConfig.name}`, 'warning');
          } else {
            setNetworkMismatch(false);
            // Reconnect with new chain
            connectWallet();
          }
        };
        
        window.ethereum.on('accountsChanged', handleAccountsChanged);
        window.ethereum.on('chainChanged', handleChainChanged);
        
        return () => {
          window.ethereum.removeListener('accountsChanged', handleAccountsChanged);
          window.ethereum.removeListener('chainChanged', handleChainChanged);
        };
      }, [networkConfig.chainId]);

      // Disconnect
      const disconnectWallet = () => {
        setSigner(null);
        setUserAddress(null);
        setIsAdmin(false);
        setNetworkMismatch(false);
        if (provider) {
          const readContract = new ethers.Contract(
            networkConfig.contractAddress,
            RAFFLE_ABI,
            provider
          );
          setContract(readContract);
        }
        showToast('Disconnected', 'success');
      };

      // Fetch contract state
      const fetchContractState = useCallback(async () => {
        if (!contract) return;

        try {
          let results;
          try {
            results = await Promise.all([
              contract.owner(),
              contract.paused(),
              contract.awaitingVrf(),
              contract.currentRaffleId(),
              contract.houseFee(),
              contract.accumulatedHouseFees(),
              contract.subscriptionId(),
              contract.keyHash(),
              contract.callbackGasLimit(),
              contract.requestConfirmations(),
            ]);
          } catch (err) {
            console.error('Error fetching contract data:', err);
            return; // Don't update state if we can't fetch
          }

          const [
            owner,
            paused,
            awaitingVrf,
            currentRaffleIdBN,
            houseFeeBN,
            accumulatedFeesBN,
            subscriptionIdBN,
            keyHash,
            callbackGasLimitBN,
            requestConfirmationsBN,
          ] = results;

          // Convert all BigNumbers to primitives immediately
          const raffleId = toNumber(currentRaffleIdBN);
          const houseFee = toNumber(houseFeeBN);
          const accumulatedFees = toBigNumberString(accumulatedFeesBN);
          const subscriptionId = toBigNumberString(subscriptionIdBN);
          const callbackGasLimit = toNumber(callbackGasLimitBN);
          const requestConfirmations = toNumber(requestConfirmationsBN);

          let currentRaffle = null;
          let ticketCount = 0;
          
          if (raffleId > 0) {
            try {
              const [raffleConfig, ticketCountBN] = await Promise.all([
                contract.getRaffleConfig(currentRaffleIdBN),
                contract.getTicketCount(currentRaffleIdBN),
              ]);
              
              // Extract and convert raffle config values
              currentRaffle = {
                ticketPrice: toBigNumberString(raffleConfig.ticketPrice),
                genericReward: String(raffleConfig.genericReward || ''),
                genericRewardAmount: toNumber(raffleConfig.genericRewardAmount),
                winnerReward: String(raffleConfig.winnerReward || ''),
                winnerRewardAmount: toNumber(raffleConfig.winnerRewardAmount),
                prizePool: toBigNumberString(raffleConfig.prizePool),
                winner: String(raffleConfig.winner || ''),
                winnerClaimed: Boolean(raffleConfig.winnerClaimed),
                isActive: Boolean(raffleConfig.isActive),
              };
              ticketCount = toNumber(ticketCountBN);
            } catch (err) {
              console.error('Error fetching raffle details:', err);
            }
          }

          setContractState({
            owner: String(owner || ''),
            paused: Boolean(paused),
            awaitingVrf: Boolean(awaitingVrf),
            currentRaffleId: raffleId,
            houseFee: houseFee,
            accumulatedFees: accumulatedFees,
            vrfConfig: {
              subscriptionId: subscriptionId,
              keyHash: String(keyHash || ''),
              callbackGasLimit: callbackGasLimit,
              requestConfirmations: requestConfirmations,
            },
            currentRaffle,
            ticketCount: ticketCount,
          });

          // Update VRF form with current values
          setVrfForm({
            subscriptionId: String(subscriptionId),
            keyHash: String(keyHash || ''),
            callbackGasLimit: String(callbackGasLimit),
            requestConfirmations: String(requestConfirmations),
          });

          // Check if user has admin role
          if (userAddress) {
            try {
              const hasAdminRole = await contract.hasRole(RAFFLE_ADMIN_ROLE, userAddress);
              setIsAdmin(Boolean(hasAdminRole));
            } catch (err) {
              console.error('Failed to check admin role:', err);
              // Fallback to owner check if hasRole fails
              setIsAdmin(userAddress.toLowerCase() === owner.toLowerCase());
            }
          }
        } catch (err) {
          console.error('Fetch error:', err);
        }
      }, [contract, userAddress]);

      // Poll for data
      useEffect(() => {
        if (!contract) return;
        fetchContractState();
        const interval = setInterval(fetchContractState, 10000);
        return () => clearInterval(interval);
      }, [contract, fetchContractState]);

      // Toast
      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 5000);
      };

      // Execute transaction with loading state
      const executeTransaction = async (action, fn) => {
        setLoadingAction(action);
        try {
          const tx = await fn();
          showToast('Transaction submitted...', 'warning');
          await tx.wait();
          showToast('Transaction confirmed!', 'success');
          fetchContractState();
        } catch (err) {
          console.error(`${action} error:`, err);
          showToast(err.reason || err.message || 'Transaction failed', 'error');
        }
        setLoadingAction(null);
      };

      // Admin Actions
      const handleStartRaffle = async () => {
        const { ticketPrice, genericReward, genericAmount, winnerReward, winnerAmount } = startRaffleForm;
        
        if (!ticketPrice || !genericReward || !winnerReward) {
          showToast('Please fill all fields', 'error');
          return;
        }

        await executeTransaction('startRaffle', () => 
          contract.startRaffle(
            parseAlice(ticketPrice),
            genericReward,
            parseInt(genericAmount),
            winnerReward,
            parseInt(winnerAmount)
          )
        );
      };

      const handleStopRaffle = async () => {
        await executeTransaction('stopRaffle', () => contract.stopRaffle());
      };

      const handleSetHouseFee = async () => {
        if (!houseFeeForm) {
          showToast('Please enter fee in basis points', 'error');
          return;
        }
        await executeTransaction('setHouseFee', () => 
          contract.setHouseFee(parseInt(houseFeeForm))
        );
      };

      const handleWithdrawFees = async () => {
        if (!withdrawAddress) {
          showToast('Please enter recipient address', 'error');
          return;
        }
        await executeTransaction('withdrawFees', () => 
          contract.withdrawHouseFees(withdrawAddress)
        );
      };

      const handleInjectCapital = async () => {
        if (!injectAmount) {
          showToast('Please enter amount', 'error');
          return;
        }

        const amount = parseAlice(injectAmount);
        
        // Check allowance
        const allowance = await aliceContract.allowance(userAddress, networkConfig.contractAddress);
        if (allowance.lt(amount)) {
          showToast('Approving tokens...', 'warning');
          const approveTx = await aliceContract.approve(networkConfig.contractAddress, amount);
          await approveTx.wait();
        }

        await executeTransaction('injectCapital', () => 
          contract.injectCapital(amount)
        );
      };

      const handleUpdateVRF = async () => {
        const { subscriptionId, keyHash, callbackGasLimit, requestConfirmations } = vrfForm;
        
        await executeTransaction('updateVRF', () => 
          contract.updateVRFConfig(
            subscriptionId,
            keyHash,
            parseInt(callbackGasLimit),
            parseInt(requestConfirmations)
          )
        );
      };

      const handleEmergencyPause = async () => {
        if (!window.confirm('Are you sure you want to emergency pause the contract?')) {
          return;
        }
        await executeTransaction('emergencyPause', () => contract.emergencyPause());
      };

      const handleTransferOwnership = async () => {
        if (!newOwner) {
          showToast('Please enter new owner address', 'error');
          return;
        }
        if (!window.confirm(`Transfer ownership to ${newOwner}? This cannot be undone!`)) {
          return;
        }
        await executeTransaction('transferOwnership', () => 
          contract.transferOwnership(newOwner)
        );
      };

      const isLoading = (action) => loadingAction === action;
      const canExecute = signer && isAdmin && !networkMismatch;

      // Helper to check if accumulated fees is zero
      const isAccumulatedFeesZero = () => {
        if (!safeContractState.accumulatedFees) return true;
        return safeContractState.accumulatedFees === '0' || safeContractState.accumulatedFees === '';
      };

      // Safety check - ensure all state values are primitives before rendering
      const safeContractState = {
        owner: String(contractState.owner || ''),
        paused: Boolean(contractState.paused),
        awaitingVrf: Boolean(contractState.awaitingVrf),
        currentRaffleId: Number(contractState.currentRaffleId) || 0,
        houseFee: Number(contractState.houseFee) || 0,
        accumulatedFees: String(contractState.accumulatedFees || '0'),
        ticketCount: Number(contractState.ticketCount) || 0,
        currentRaffle: contractState.currentRaffle ? {
          ...contractState.currentRaffle,
          prizePool: String(contractState.currentRaffle.prizePool || '0'),
          isActive: Boolean(contractState.currentRaffle.isActive),
        } : null,
      };

      return (
        <>
          {/* Network Indicator */}
          <div className={`network-indicator ${activeNetwork}`}>
            <span className={`network-icon ${activeNetwork}`}></span>
            {networkConfig.name}
          </div>

          <header className="header">
            <div className="header-left">
              <a href="index.html" className="logo">ALICE RAFFLE</a>
              <span className="admin-badge">Admin Panel</span>
              <a href="index.html" className="back-link">‚Üê Back to Main</a>
            </div>
            
            {/* Network Switcher */}
            <div className="network-switcher">
              <button 
                className={`network-btn sepolia ${activeNetwork === 'sepolia' ? 'active' : ''}`}
                onClick={() => switchNetwork('sepolia')}
              >
                <span className="network-icon sepolia"></span>
                Sepolia
              </button>
               <button 
                className={`network-btn bscTestnet ${activeNetwork === 'bscTestnet' ? 'active' : ''}`}
                onClick={() => switchNetwork('bscTestnet')}
              >
                <span className="network-icon bscTestnet"></span>
                BSC Testnet
              </button>
              <button 
                className={`network-btn bsc ${activeNetwork === 'bsc' ? 'active' : ''}`}
                onClick={() => switchNetwork('bsc')}
              >
                <span className="network-icon bsc"></span>
                BSC
              </button>
               <button 
                className={`network-btn eth ${activeNetwork === 'eth' ? 'active' : ''}`}
                onClick={() => switchNetwork('eth')}
              >
                <span className="network-icon eth"></span>
                ETH
              </button>
            </div>
            
            <div className="wallet-info">
              {userAddress ? (
                <>
                  <button className="connect-btn connected" onClick={disconnectWallet}>
                    Connected
                  </button>
                  <div className="wallet-address">{shortenAddress(userAddress)}</div>
                  {networkMismatch ? (
                    <div className="owner-status not-owner">‚ö†Ô∏è Wrong Network</div>
                  ) : (
                    <div className={`owner-status ${isAdmin ? 'is-owner' : 'not-owner'}`}>
                      {isAdmin ? '‚úì Raffle Admin' : '‚úó Not Admin'}
                    </div>
                  )}
                </>
              ) : (
                <button className="connect-btn" onClick={connectWallet}>
                  Connect Wallet
                </button>
              )}
            </div>
          </header>

          <main className="main">
            {loading ? (
              <div className="loading-container">
                <div className="loading-spinner"></div>
                <div className="loading-text">Loading {networkConfig.shortName || networkConfig.displayName || 'Network'}...</div>
              </div>
            ) : !userAddress ? (
              <div className="not-connected">
                <div className="not-connected-icon">üîê</div>
                <h2>Connect Your Wallet</h2>
                <p>Connect your wallet to access admin functions on {networkConfig.name}</p>
                <button className="btn btn-primary" onClick={connectWallet} style={{maxWidth: '300px', margin: '0 auto'}}>
                  Connect Wallet
                </button>
              </div>
            ) : networkMismatch ? (
              <div className="not-connected">
                <div className="not-connected-icon">‚ö†Ô∏è</div>
                <h2>Wrong Network</h2>
                <p>Please switch your wallet to {networkConfig.name}</p>
                <button className="btn btn-primary" onClick={requestWalletNetworkSwitch} style={{maxWidth: '300px', margin: '0 auto'}}>
                  Switch to {networkConfig.shortName || networkConfig.displayName || 'Network'}
                </button>
              </div>
            ) : (
              <>
                {/* Status Bar */}
                <div className="status-bar">
                  <div className="status-item">
                    <span className="status-label">Network</span>
                    <span className="status-value">{networkConfig.shortName || networkConfig.displayName || 'Unknown'}</span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">Status</span>
                    <span className={`status-value ${safeContractState.paused ? 'paused' : 'active'}`}>
                      {safeContractState.paused ? '‚è∏ Paused' : '‚ñ∂ Active'}
                    </span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">Raffle ID</span>
                    <span className="status-value">#{String(safeContractState.currentRaffleId)}</span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">VRF</span>
                    <span className={`status-value ${safeContractState.awaitingVrf ? 'pending' : 'active'}`}>
                      {safeContractState.awaitingVrf ? '‚è≥ Pending' : '‚úì Ready'}
                    </span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">Tickets</span>
                    <span className="status-value">{String(safeContractState.ticketCount)}</span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">House Fee</span>
                    <span className="status-value">{String(safeContractState.houseFee / 100)}%</span>
                  </div>
                  <div className="status-item">
                    <span className="status-label">Accumulated Fees</span>
                    <span className="status-value">{formatAlice(safeContractState.accumulatedFees)} ALICE</span>
                  </div>
                </div>

                <div className="grid">
                  {/* Start Raffle */}
                  <div className="card">
                    <h3 className="card-title">
                      <span className="card-title-icon">üé∞</span>
                      Start New Raffle
                    </h3>
                    
                    <div className="form-group">
                      <label className="form-label">Ticket Price (ALICE)</label>
                      <input
                        type="number"
                        className="form-input"
                        placeholder="10"
                        value={startRaffleForm.ticketPrice}
                        onChange={(e) => setStartRaffleForm({...startRaffleForm, ticketPrice: e.target.value})}
                      />
                    </div>

                    <div className="form-row">
                      <div className="form-group">
                        <label className="form-label">Generic Reward Name</label>
                        <input
                          type="text"
                          className="form-input"
                          placeholder="participation_nft"
                          value={startRaffleForm.genericReward}
                          onChange={(e) => setStartRaffleForm({...startRaffleForm, genericReward: e.target.value})}
                        />
                      </div>
                      <div className="form-group">
                        <label className="form-label">Amount</label>
                        <input
                          type="number"
                          className="form-input"
                          placeholder="1"
                          value={startRaffleForm.genericAmount}
                          onChange={(e) => setStartRaffleForm({...startRaffleForm, genericAmount: e.target.value})}
                        />
                      </div>
                    </div>

                    <div className="form-row">
                      <div className="form-group">
                        <label className="form-label">Winner Reward Name</label>
                        <input
                          type="text"
                          className="form-input"
                          placeholder="winner_nft"
                          value={startRaffleForm.winnerReward}
                          onChange={(e) => setStartRaffleForm({...startRaffleForm, winnerReward: e.target.value})}
                        />
                      </div>
                      <div className="form-group">
                        <label className="form-label">Amount</label>
                        <input
                          type="number"
                          className="form-input"
                          placeholder="1"
                          value={startRaffleForm.winnerAmount}
                          onChange={(e) => setStartRaffleForm({...startRaffleForm, winnerAmount: e.target.value})}
                        />
                      </div>
                    </div>

                    <button 
                      className={`btn btn-success ${isLoading('startRaffle') ? 'loading' : ''}`}
                      onClick={handleStartRaffle}
                      disabled={!canExecute || !safeContractState.paused || safeContractState.awaitingVrf || isLoading('startRaffle')}
                    >
                      {isLoading('startRaffle') ? 'Starting...' : 'Start Raffle'}
                    </button>
                    {!safeContractState.paused && <p className="form-hint">‚ö†Ô∏è Stop current raffle first</p>}
                  </div>

                  {/* Stop Raffle */}
                  <div className="card">
                    <h3 className="card-title">
                      <span className="card-title-icon">üõë</span>
                      Stop Raffle
                    </h3>
                    
                    {safeContractState.currentRaffle && (
                      <div className="info-box">
                        <div className="info-row">
                          <span className="info-label">Prize Pool</span>
                          <span className="info-value">{formatAlice(safeContractState.currentRaffle.prizePool)} ALICE</span>
                        </div>
                        <div className="info-row">
                          <span className="info-label">Tickets Sold</span>
                          <span className="info-value">{String(safeContractState.ticketCount)}</span>
                        </div>
                        <div className="info-row">
                          <span className="info-label">Status</span>
                          <span className="info-value">{safeContractState.currentRaffle.isActive ? 'Active' : 'Inactive'}</span>
                        </div>
                      </div>
                    )}

                    <button 
                      className={`btn btn-warning ${isLoading('stopRaffle') ? 'loading' : ''}`}
                      onClick={handleStopRaffle}
                      disabled={!canExecute || safeContractState.paused || safeContractState.ticketCount === 0 || isLoading('stopRaffle')}
                    >
                      {isLoading('stopRaffle') ? 'Stopping...' : 'Stop Raffle & Select Winner'}
                    </button>
                    {safeContractState.ticketCount === 0 && !safeContractState.paused && (
                      <p className="form-hint">‚ö†Ô∏è Need at least 1 participant</p>
                    )}
                  </div>

                  {/* Inject Capital */}
                  <div className="card">
                    <h3 className="card-title">
                      <span className="card-title-icon">üí∞</span>
                      Inject Capital
                    </h3>
                    
                    <div className="form-group">
                      <label className="form-label">Amount (ALICE)</label>
                      <input
                        type="number"
                        className="form-input"
                        placeholder="100"
                        value={injectAmount}
                        onChange={(e) => setInjectAmount(e.target.value)}
                      />
                      <p className="form-hint">Add to prize pool without getting tickets</p>
                    </div>

                    <button 
                      className={`btn btn-primary ${isLoading('injectCapital') ? 'loading' : ''}`}
                      onClick={handleInjectCapital}
                      disabled={!signer || safeContractState.paused || isLoading('injectCapital') || networkMismatch}
                    >
                      {isLoading('injectCapital') ? 'Injecting...' : 'Inject Capital'}
                    </button>
                  </div>

                  {/* House Fee */}
                  <div className="card">
                    <h3 className="card-title">
                      <span className="card-title-icon">üìä</span>
                      House Fee Settings
                    </h3>

                    <div className="info-box">
                      <div className="info-row">
                        <span className="info-label">Current Fee</span>
                        <span className="info-value">{String(safeContractState.houseFee / 100)}%</span>
                      </div>
                      <div className="info-row">
                        <span className="info-label">Accumulated</span>
                        <span className="info-value">{formatAlice(safeContractState.accumulatedFees)} ALICE</span>
                      </div>
                    </div>
                    
                    <div className="form-group">
                      <label className="form-label">New Fee (Basis Points)</label>
                      <input
                        type="number"
                        className="form-input"
                        placeholder="2500 = 25%"
                        value={houseFeeForm}
                        onChange={(e) => setHouseFeeForm(e.target.value)}
                      />
                      <p className="form-hint">100 = 1%, Max 5000 = 50%</p>
                    </div>

                    <button 
                      className={`btn btn-primary ${isLoading('setHouseFee') ? 'loading' : ''}`}
                      onClick={handleSetHouseFee}
                      disabled={!canExecute || isLoading('setHouseFee')}
                      style={{marginBottom: '1rem'}}
                    >
                      {isLoading('setHouseFee') ? 'Updating...' : 'Update Fee'}
                    </button>

                    <div className="form-group">
                      <label className="form-label">Withdraw To Address</label>
                      <input
                        type="text"
                        className="form-input"
                        placeholder="0x..."
                        value={withdrawAddress}
                        onChange={(e) => setWithdrawAddress(e.target.value)}
                      />
                    </div>

                    <button 
                      className={`btn btn-success ${isLoading('withdrawFees') ? 'loading' : ''}`}
                      onClick={handleWithdrawFees}
                      disabled={!canExecute || isAccumulatedFeesZero() || isLoading('withdrawFees')}
                    >
                      {isLoading('withdrawFees') ? 'Withdrawing...' : 'Withdraw Fees'}
                    </button>
                  </div>

                  {/* VRF Config */}
                  <div className="card">
                    <h3 className="card-title">
                      <span className="card-title-icon">üîó</span>
                      VRF Configuration
                    </h3>

                    <div className="form-group">
                      <label className="form-label">Subscription ID</label>
                      <input
                        type="text"
                        className="form-input"
                        value={vrfForm.subscriptionId}
                        onChange={(e) => setVrfForm({...vrfForm, subscriptionId: e.target.value})}
                      />
                    </div>

                    <div className="form-group">
                      <label className="form-label">Key Hash</label>
                      <input
                        type="text"
                        className="form-input"
                        value={vrfForm.keyHash}
                        onChange={(e) => setVrfForm({...vrfForm, keyHash: e.target.value})}
                      />
                    </div>

                    <div className="form-row">
                      <div className="form-group">
                        <label className="form-label">Callback Gas Limit</label>
                        <input
                          type="number"
                          className="form-input"
                          value={vrfForm.callbackGasLimit}
                          onChange={(e) => setVrfForm({...vrfForm, callbackGasLimit: e.target.value})}
                        />
                      </div>
                      <div className="form-group">
                        <label className="form-label">Confirmations</label>
                        <input
                          type="number"
                          className="form-input"
                          value={vrfForm.requestConfirmations}
                          onChange={(e) => setVrfForm({...vrfForm, requestConfirmations: e.target.value})}
                        />
                      </div>
                    </div>

                    <button 
                      className={`btn btn-primary ${isLoading('updateVRF') ? 'loading' : ''}`}
                      onClick={handleUpdateVRF}
                      disabled={!canExecute || isLoading('updateVRF')}
                    >
                      {isLoading('updateVRF') ? 'Updating...' : 'Update VRF Config'}
                    </button>
                  </div>

                  {/* Danger Zone */}
                  <div className="card danger">
                    <h3 className="card-title">
                      <span className="card-title-icon">‚ö†Ô∏è</span>
                      Danger Zone
                    </h3>

                    <button 
                      className={`btn btn-danger ${isLoading('emergencyPause') ? 'loading' : ''}`}
                      onClick={handleEmergencyPause}
                      disabled={!canExecute || safeContractState.paused || safeContractState.awaitingVrf || isLoading('emergencyPause')}
                      style={{marginBottom: '1rem'}}
                    >
                      {isLoading('emergencyPause') ? 'Pausing...' : 'Emergency Pause'}
                    </button>

                    <div className="form-group">
                      <label className="form-label">Transfer Ownership To</label>
                      <input
                        type="text"
                        className="form-input"
                        placeholder="0x..."
                        value={newOwner}
                        onChange={(e) => setNewOwner(e.target.value)}
                      />
                      <p className="form-hint">‚ö†Ô∏è This action cannot be undone!</p>
                    </div>

                    <button 
                      className={`btn btn-danger ${isLoading('transferOwnership') ? 'loading' : ''}`}
                      onClick={handleTransferOwnership}
                      disabled={!canExecute || isLoading('transferOwnership')}
                    >
                      {isLoading('transferOwnership') ? 'Transferring...' : 'Transfer Ownership'}
                    </button>
                  </div>
                </div>
              </>
            )}
          </main>

          <footer className="footer">
            Admin Panel ‚Ä¢ {networkConfig.name} ‚Ä¢ Contract: <a 
              href={`${networkConfig.blockExplorer}/address/${networkConfig.contractAddress}`} 
              target="_blank" 
              rel="noopener noreferrer"
              className="contract-address-link"
            >{shortenAddress(networkConfig.contractAddress)}</a>
          </footer>

          {toast && (
            <div className={`toast ${toast.type}`}>
              {toast.message}
            </div>
          )}
        </>
      );
    }

    // Mount
    ReactDOM.createRoot(document.getElementById('root')).render(<AdminApp />);
  </script>
</body>
</html>
