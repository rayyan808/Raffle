<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALICE Raffle</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --color-bg-primary: #0a0a0f;
      --color-bg-secondary: #12121a;
      --color-bg-card: rgba(18, 18, 26, 0.8);
      --color-accent-primary: #00f0ff;
      --color-accent-secondary: #ff00aa;
      --color-accent-gold: #ffd700;
      --color-text-primary: #ffffff;
      --color-text-secondary: #8a8a9a;
      --color-border: rgba(0, 240, 255, 0.2);
      --color-success: #00ff88;
      --color-warning: #ffaa00;
      --font-display: 'Orbitron', sans-serif;
      --font-body: 'Rajdhani', sans-serif;
      --glow-cyan: 0 0 20px rgba(0, 240, 255, 0.5), 0 0 40px rgba(0, 240, 255, 0.2);
      --glow-pink: 0 0 20px rgba(255, 0, 170, 0.5), 0 0 40px rgba(255, 0, 170, 0.2);
      --glow-gold: 0 0 20px rgba(255, 215, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated Background */
    .bg-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    .bg-gradient {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(255, 0, 170, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* App Container */
    #root {
      position: relative;
      z-index: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--color-border);
      backdrop-filter: blur(10px);
      background: rgba(10, 10, 15, 0.8);
    }

    .logo {
      font-family: var(--font-display);
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: 0.1em;
      background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: var(--glow-cyan);
    }

    .connect-btn {
      font-family: var(--font-display);
      font-size: 0.85rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      padding: 0.8rem 1.5rem;
      background: transparent;
      border: 2px solid var(--color-accent-primary);
      color: var(--color-accent-primary);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }

    .connect-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .connect-btn:hover::before {
      left: 100%;
    }

    .connect-btn:hover {
      background: rgba(0, 240, 255, 0.1);
      box-shadow: var(--glow-cyan);
    }

    .connect-btn.connected {
      border-color: var(--color-success);
      color: var(--color-success);
    }

    .wallet-address {
      font-family: var(--font-body);
      font-size: 0.8rem;
      color: var(--color-text-secondary);
      margin-top: 0.3rem;
    }

    /* Main Content */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 2rem;
    }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1.2rem;
      border-radius: 50px;
      font-family: var(--font-display);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 2rem;
    }

    .status-badge.active {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--color-success);
      color: var(--color-success);
    }

    .status-badge.inactive {
      background: rgba(255, 170, 0, 0.1);
      border: 1px solid var(--color-warning);
      color: var(--color-warning);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-badge.active .status-dot {
      background: var(--color-success);
      box-shadow: 0 0 10px var(--color-success);
    }

    .status-badge.inactive .status-dot {
      background: var(--color-warning);
      box-shadow: 0 0 10px var(--color-warning);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Cards */
    .card {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      backdrop-filter: blur(20px);
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--color-accent-primary), var(--color-accent-secondary));
    }

    .card-title {
      font-family: var(--font-display);
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 1.5rem;
      color: var(--color-text-primary);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-item {
      text-align: center;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-family: var(--font-display);
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--color-accent-primary);
      text-shadow: var(--glow-cyan);
    }

    .stat-value.gold {
      color: var(--color-accent-gold);
      text-shadow: var(--glow-gold);
    }

    .stat-value.pink {
      color: var(--color-accent-secondary);
      text-shadow: var(--glow-pink);
    }

    .stat-unit {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
      margin-left: 0.3rem;
    }

    /* Rewards Section */
    .rewards-section {
      border-top: 1px solid var(--color-border);
      padding-top: 1.5rem;
      margin-top: 1rem;
    }

    .reward-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: rgba(255, 215, 0, 0.05);
      border: 1px solid rgba(255, 215, 0, 0.2);
      margin-bottom: 1rem;
    }

    .reward-icon {
      font-size: 1.5rem;
      margin-right: 1rem;
    }

    .reward-info {
      flex: 1;
    }

    .reward-name {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-accent-gold);
    }

    .reward-type {
      font-size: 0.7rem;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .reward-amount {
      font-family: var(--font-display);
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--color-accent-gold);
    }

    /* Winner Section */
    .winner-section {
      text-align: center;
      padding: 2rem;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 0, 170, 0.1));
      border: 1px solid rgba(255, 215, 0, 0.3);
      margin-bottom: 1.5rem;
    }

    .winner-label {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--color-accent-gold);
      margin-bottom: 0.5rem;
    }

    .winner-address {
      font-family: var(--font-display);
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--color-text-primary);
      word-break: break-all;
      margin-bottom: 1rem;
    }

    .winner-prize {
      font-family: var(--font-display);
      font-size: 2rem;
      font-weight: 800;
      color: var(--color-accent-gold);
      text-shadow: var(--glow-gold);
    }

    /* Claim Button */
    .claim-btn {
      width: 100%;
      padding: 1.2rem 2rem;
      font-family: var(--font-display);
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--color-accent-gold), #ff8c00);
      border: none;
      color: #000;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .claim-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--glow-gold);
    }

    .claim-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .claim-btn.loading {
      pointer-events: none;
    }

    .claim-btn.loading::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 200%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    /* Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid var(--color-border);
      border-top-color: var(--color-accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-family: var(--font-display);
      font-size: 0.85rem;
      letter-spacing: 0.2em;
      color: var(--color-text-secondary);
      text-transform: uppercase;
    }

    /* Error State */
    .error-message {
      text-align: center;
      padding: 2rem;
      background: rgba(255, 0, 0, 0.1);
      border: 1px solid rgba(255, 0, 0, 0.3);
      color: #ff6b6b;
    }

    /* No Winner State */
    .no-winner {
      text-align: center;
      padding: 2rem;
      color: var(--color-text-secondary);
    }

    .no-winner-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      backdrop-filter: blur(10px);
      font-family: var(--font-body);
      font-size: 0.9rem;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      border-color: var(--color-success);
      color: var(--color-success);
    }

    .toast.error {
      border-color: #ff6b6b;
      color: #ff6b6b;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Raffle ID */
    .raffle-id {
      font-family: var(--font-display);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      color: var(--color-text-secondary);
      text-align: center;
      margin-bottom: 1rem;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 1.5rem;
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      border-top: 1px solid var(--color-border);
    }

    /* Responsive */
    @media (max-width: 600px) {
      .header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .card {
        padding: 1.5rem;
      }

      .stat-value {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-gradient"></div>
  <div id="root"></div>

  <!-- React & Dependencies -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/modal@8.0.1/dist/modal.umd.min.js"></script>
  
  <!-- Configuration (edit config.js to customize) -->
  <script src="config.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    const { ethers } = window;

    // ============ Load Configuration ============
    
    // Get config from external file or use defaults
    const CONFIG = window.RAFFLE_CONFIG || {};
    
    // Contract address - UPDATE THIS or set in config.js
    const RAFFLE_CONTRACT_ADDRESS = CONFIG.RAFFLE_CONTRACT_ADDRESS || '0x0000000000000000000000000000000000000000';
    
    // Web3Auth Client ID - Get from https://dashboard.web3auth.io
    const WEB3AUTH_CLIENT_ID = CONFIG.WEB3AUTH_CLIENT_ID || 'YOUR_WEB3AUTH_CLIENT_ID';
    
    // Web3Auth network
    const WEB3AUTH_NETWORK = CONFIG.WEB3AUTH_NETWORK || 'sapphire_devnet';
    
    // Active network configuration
    const ACTIVE_NETWORK = CONFIG.ACTIVE_NETWORK || 'sepolia';
    const NETWORKS = CONFIG.NETWORKS || {
      sepolia: {
        chainId: '0xaa36a7',
        chainNamespace: 'eip155',
        rpcTarget: 'https://rpc.sepolia.org',
        displayName: 'Sepolia Testnet',
        blockExplorer: 'https://sepolia.etherscan.io',
        ticker: 'ETH',
        tickerName: 'Ethereum',
      }
    };
    
    const CHAIN_CONFIG = NETWORKS[ACTIVE_NETWORK] || NETWORKS.sepolia;

    // ALICE Token decimals
    const ALICE_DECIMALS = CONFIG.ALICE_DECIMALS || 6;
    
    // Polling interval
    const POLL_INTERVAL = CONFIG.POLL_INTERVAL || 15000;
    
    // Toast duration
    const TOAST_DURATION = CONFIG.TOAST_DURATION || 4000;

    // Contract ABI (minimal for our needs)
    const RAFFLE_ABI = [
      "function paused() view returns (bool)",
      "function currentRaffleId() view returns (uint256)",
      "function getRaffleConfig(uint256 raffleId) view returns (tuple(uint256 ticketPrice, string genericReward, uint8 genericRewardAmount, string winnerReward, uint8 winnerRewardAmount, uint256 prizePool, address winner, bool winnerClaimed, bool isActive))",
      "function getTicketCount(uint256 raffleId) view returns (uint256)",
      "function calculateWinnerPrize(uint256 raffleId) view returns (uint256)",
      "function claimWinnerReward(uint256 raffleId)",
      "function getWinner(uint256 raffleId) view returns (address)",
    ];

    // ============ Helper Functions ============

    const formatAlice = (amount) => {
      if (!amount) return '0';
      return ethers.utils.formatUnits(amount, ALICE_DECIMALS);
    };

    const shortenAddress = (address) => {
      if (!address) return '';
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    };

    // ============ Main App Component ============

    function App() {
      // State
      const [web3auth, setWeb3auth] = useState(null);
      const [provider, setProvider] = useState(null);
      const [signer, setSigner] = useState(null);
      const [userAddress, setUserAddress] = useState(null);
      const [contract, setContract] = useState(null);
      
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [toast, setToast] = useState(null);
      
      const [raffleData, setRaffleData] = useState(null);
      const [isActive, setIsActive] = useState(false);
      const [claiming, setClaiming] = useState(false);

      // Initialize Web3Auth
      useEffect(() => {
        const init = async () => {
          try {
            const web3authInstance = new window.Modal.Web3Auth({
              clientId: WEB3AUTH_CLIENT_ID,
              web3AuthNetwork: WEB3AUTH_NETWORK,
              chainConfig: {
                chainNamespace: CHAIN_CONFIG.chainNamespace,
                chainId: CHAIN_CONFIG.chainId,
                rpcTarget: CHAIN_CONFIG.rpcTarget,
                displayName: CHAIN_CONFIG.displayName,
                blockExplorerUrl: CHAIN_CONFIG.blockExplorer,
                ticker: CHAIN_CONFIG.ticker,
                tickerName: CHAIN_CONFIG.tickerName,
              },
            });

            await web3authInstance.initModal();
            setWeb3auth(web3authInstance);

            // Check if already connected
            if (web3authInstance.connected) {
              await handleConnected(web3authInstance);
            }
          } catch (err) {
            console.error('Web3Auth init error:', err);
            // Fallback to read-only mode with default provider
            const readOnlyProvider = new ethers.providers.JsonRpcProvider(CHAIN_CONFIG.rpcTarget);
            setProvider(readOnlyProvider);
          }

          setLoading(false);
        };

        init();
      }, []);

      // Handle successful connection
      const handleConnected = async (web3authInstance) => {
        const web3authProvider = await web3authInstance.provider;
        const ethersProvider = new ethers.providers.Web3Provider(web3authProvider);
        const ethersSigner = ethersProvider.getSigner();
        const address = await ethersSigner.getAddress();

        setProvider(ethersProvider);
        setSigner(ethersSigner);
        setUserAddress(address);
      };

      // Connect wallet
      const connectWallet = async () => {
        if (!web3auth) return;

        try {
          await web3auth.connect();
          await handleConnected(web3auth);
          showToast('Wallet connected!', 'success');
        } catch (err) {
          console.error('Connect error:', err);
          showToast('Failed to connect wallet', 'error');
        }
      };

      // Disconnect wallet
      const disconnectWallet = async () => {
        if (!web3auth) return;

        try {
          await web3auth.logout();
          setSigner(null);
          setUserAddress(null);
          showToast('Wallet disconnected', 'success');
        } catch (err) {
          console.error('Disconnect error:', err);
        }
      };

      // Initialize contract when provider is ready
      useEffect(() => {
        if (!provider) return;

        const raffleContract = new ethers.Contract(
          RAFFLE_CONTRACT_ADDRESS,
          RAFFLE_ABI,
          signer || provider
        );
        setContract(raffleContract);
      }, [provider, signer]);

      // Fetch raffle data
      const fetchRaffleData = useCallback(async () => {
        if (!contract) return;

        try {
          const [paused, currentRaffleId] = await Promise.all([
            contract.paused(),
            contract.currentRaffleId(),
          ]);

          const raffleId = currentRaffleId.toNumber();
          
          if (raffleId === 0) {
            setRaffleData({ raffleId: 0, noRaffle: true });
            setIsActive(false);
            return;
          }

          const [config, ticketCount] = await Promise.all([
            contract.getRaffleConfig(raffleId),
            contract.getTicketCount(raffleId),
          ]);

          let winnerPrize = ethers.BigNumber.from(0);
          if (config.winner !== ethers.constants.AddressZero && !config.winnerClaimed) {
            try {
              winnerPrize = await contract.calculateWinnerPrize(raffleId);
            } catch (e) {
              // Prize might not be calculable
            }
          }

          setRaffleData({
            raffleId,
            ticketPrice: config.ticketPrice,
            genericReward: config.genericReward,
            genericRewardAmount: config.genericRewardAmount,
            winnerReward: config.winnerReward,
            winnerRewardAmount: config.winnerRewardAmount,
            prizePool: config.prizePool,
            winner: config.winner,
            winnerClaimed: config.winnerClaimed,
            isActive: config.isActive,
            ticketCount: ticketCount.toNumber(),
            winnerPrize,
          });

          setIsActive(!paused && config.isActive);
          setError(null);
        } catch (err) {
          console.error('Fetch error:', err);
          setError('Failed to load raffle data. Please check the contract address and network.');
        }
      }, [contract]);

      // Fetch data on contract change and poll
      useEffect(() => {
        if (!contract) return;

        fetchRaffleData();
        const interval = setInterval(fetchRaffleData, POLL_INTERVAL);

        return () => clearInterval(interval);
      }, [contract, fetchRaffleData]);

      // Claim reward
      const claimReward = async () => {
        if (!contract || !signer || !raffleData) return;

        setClaiming(true);
        try {
          const tx = await contract.claimWinnerReward(raffleData.raffleId);
          showToast('Transaction submitted...', 'success');
          await tx.wait();
          showToast('Reward claimed successfully!', 'success');
          fetchRaffleData();
        } catch (err) {
          console.error('Claim error:', err);
          showToast(err.reason || 'Failed to claim reward', 'error');
        }
        setClaiming(false);
      };

      // Toast notification
      const showToast = (message, type) => {
        setToast({ message, type });
        setTimeout(() => setToast(null), TOAST_DURATION);
      };

      // Check if current user is winner
      const isUserWinner = userAddress && raffleData?.winner && 
        userAddress.toLowerCase() === raffleData.winner.toLowerCase();

      // Render
      return (
        <>
          <header className="header">
            <div className="logo">ALICE RAFFLE</div>
            <div>
              {userAddress ? (
                <div style={{ textAlign: 'right' }}>
                  <button className="connect-btn connected" onClick={disconnectWallet}>
                    Connected
                  </button>
                  <div className="wallet-address">{shortenAddress(userAddress)}</div>
                </div>
              ) : (
                <button className="connect-btn" onClick={connectWallet}>
                  Connect Wallet
                </button>
              )}
            </div>
          </header>

          <main className="main">
            {loading ? (
              <div className="loading-container">
                <div className="loading-spinner"></div>
                <div className="loading-text">Initializing</div>
              </div>
            ) : error ? (
              <div className="card">
                <div className="error-message">{error}</div>
              </div>
            ) : raffleData?.noRaffle ? (
              <div className="card">
                <div className="no-winner">
                  <div className="no-winner-icon">üé∞</div>
                  <p>No raffle has been started yet.</p>
                </div>
              </div>
            ) : isActive ? (
              // STATE B: Raffle Active
              <>
                <div className={`status-badge active`}>
                  <span className="status-dot"></span>
                  Raffle Active
                </div>

                <div className="card">
                  <div className="raffle-id">Raffle #{raffleData?.raffleId}</div>
                  <h2 className="card-title">Current Raffle</h2>

                  <div className="stats-grid">
                    <div className="stat-item">
                      <div className="stat-label">Prize Pool</div>
                      <div className="stat-value gold">
                        {formatAlice(raffleData?.prizePool)}
                        <span className="stat-unit">ALICE</span>
                      </div>
                    </div>
                    <div className="stat-item">
                      <div className="stat-label">Tickets Sold</div>
                      <div className="stat-value">
                        {raffleData?.ticketCount || 0}
                      </div>
                    </div>
                  </div>

                  <div className="rewards-section">
                    <div className="reward-item">
                      <span className="reward-icon">üéÅ</span>
                      <div className="reward-info">
                        <div className="reward-name">{raffleData?.genericReward || 'N/A'}</div>
                        <div className="reward-type">Participation Reward</div>
                      </div>
                      <div className="reward-amount">x{raffleData?.genericRewardAmount || 0}</div>
                    </div>

                    <div className="reward-item">
                      <span className="reward-icon">üèÜ</span>
                      <div className="reward-info">
                        <div className="reward-name">{raffleData?.winnerReward || 'N/A'}</div>
                        <div className="reward-type">Winner Reward</div>
                      </div>
                      <div className="reward-amount">x{raffleData?.winnerRewardAmount || 0}</div>
                    </div>
                  </div>
                </div>
              </>
            ) : (
              // STATE A: Raffle Inactive
              <>
                <div className={`status-badge inactive`}>
                  <span className="status-dot"></span>
                  Raffle Ended
                </div>

                <div className="card">
                  <div className="raffle-id">Raffle #{raffleData?.raffleId}</div>
                  <h2 className="card-title">Previous Raffle</h2>

                  {raffleData?.winner && raffleData.winner !== ethers.constants.AddressZero ? (
                    <>
                      <div className="winner-section">
                        <div className="winner-label">üèÜ Winner</div>
                        <div className="winner-address">
                          {isUserWinner ? 'üéâ YOU!' : shortenAddress(raffleData.winner)}
                        </div>
                        {!raffleData.winnerClaimed && (
                          <div className="winner-prize">
                            {formatAlice(raffleData.winnerPrize)} ALICE
                          </div>
                        )}
                        {raffleData.winnerClaimed && (
                          <div style={{ color: 'var(--color-success)', fontSize: '0.85rem' }}>
                            ‚úì Prize Claimed
                          </div>
                        )}
                      </div>

                      <div className="rewards-section">
                        <div className="reward-item">
                          <span className="reward-icon">üèÜ</span>
                          <div className="reward-info">
                            <div className="reward-name">{raffleData?.winnerReward || 'N/A'}</div>
                            <div className="reward-type">Winner Reward</div>
                          </div>
                          <div className="reward-amount">x{raffleData?.winnerRewardAmount || 0}</div>
                        </div>
                      </div>

                      {isUserWinner && !raffleData.winnerClaimed && (
                        <button 
                          className={`claim-btn ${claiming ? 'loading' : ''}`}
                          onClick={claimReward}
                          disabled={claiming || !signer}
                        >
                          {claiming ? 'Claiming...' : 'Claim Your Reward'}
                        </button>
                      )}

                      {!userAddress && !raffleData.winnerClaimed && (
                        <p style={{ textAlign: 'center', color: 'var(--color-text-secondary)', marginTop: '1rem', fontSize: '0.85rem' }}>
                          Connect your wallet to check if you're the winner
                        </p>
                      )}
                    </>
                  ) : (
                    <div className="no-winner">
                      <div className="no-winner-icon">‚è≥</div>
                      <p>Awaiting winner selection...</p>
                      <p style={{ fontSize: '0.8rem', marginTop: '0.5rem' }}>
                        The VRF callback will determine the winner shortly.
                      </p>
                    </div>
                  )}
                </div>
              </>
            )}
          </main>

          <footer className="footer">
            <p>Powered by Chainlink VRF ‚Ä¢ Built on {CHAIN_CONFIG.displayName}</p>
          </footer>

          {toast && (
            <div className={`toast ${toast.type}`}>
              {toast.message}
            </div>
          )}
        </>
      );
    }

    // Mount App
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
